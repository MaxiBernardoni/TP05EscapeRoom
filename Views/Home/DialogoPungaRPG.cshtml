@{
    ViewData["Title"] = "Diálogo con el Punga (RPG)";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
.rpg-dialogue-container {
    max-width: 700px;
    margin: 60px auto 0 auto;
    background: #181818;
    border-radius: 16px;
    box-shadow: 0 0 24px #000a;
    padding: 32px 24px 24px 24px;
    color: #fff;
    font-family: 'Segoe UI', sans-serif;
    position: relative;
}
.rpg-dialogue-box {
    display: flex;
    align-items: flex-end;
    margin-bottom: 24px;
    min-height: 140px;
}
.rpg-dialogue-img {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid #00eaff;
    background: #fff;
    margin-right: 24px;
    margin-left: 24px;
    box-shadow: 0 0 12px #00eaff55;
}
.rpg-dialogue-text {
    background: #232323;
    border-radius: 12px;
    padding: 18px 24px;
    font-size: 1.2em;
    min-width: 200px;
    max-width: 420px;
    box-shadow: 0 2px 8px #0003;
}
.rpg-dialogue-speaker {
    font-weight: bold;
    color: #00eaff;
    margin-bottom: 6px;
    font-size: 1em;
}
.rpg-dialogue-btn {
    display: block;
    margin: 0 auto;
    padding: 10px 32px;
    font-size: 1.1em;
    border-radius: 8px;
    border: none;
    background: #00eaff;
    color: #222;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s;
}
.rpg-dialogue-btn:active {
    background: #00b8c6;
}
.rpg-dialogue-center {
    text-align: center;
    margin: 24px 0;
}
</style>

<div class="rpg-dialogue-container">
    <div id="dialogueBox" class="rpg-dialogue-box">
        <!-- Diálogo dinámico -->
    </div>
    <div class="rpg-dialogue-center">
        <button id="nextBtn" class="rpg-dialogue-btn" onclick="nextDialogue()">Siguiente</button>
    </div>
</div>

<script>
const dialogue = [
    { speaker: "Usuario", img: "/img/usuario.png", text: "Uhhh, una pinta de chorro este. (Comentario)" },
    { speaker: "Punga", img: "/img/punga.png", text: "Hola capo, mostro, genio. Como estas? como anda la familia? espero que muy bien. Mirá yo te vengo a pedir un poco de plata para mi familia que estamos en una mala situación…" },
    { speaker: "Usuario", img: "/img/usuario.png", text: "No pa. No tengo nada, disculpá." },
    { speaker: "Punga", img: "/img/punga.png", text: "Ta bien amigo. No hay drama." },
    { speaker: "Narrador", img: "/img/punga.png", text: "(El usuario se da vuelta y recibe un manotazo de atrás)" },
    { speaker: "Usuario", img: "/img/usuario.png", text: "Para amigo. ¿Qué hacés?" },
    { speaker: "Punga", img: "/img/punga.png", text: "Y bueno gato. Te regalaste ameo." },
    { speaker: "Usuario", img: "/img/usuario.png", text: "Bueno bueno, flaquito, cortala o te mato." },
    { speaker: "Punga", img: "/img/punga.png", text: "¿A quién vas a matar vos? piscuin." },
    { speaker: "Usuario", img: "/img/usuario.png", text: "Y bueno pa. No te hagas el picante porque no te sale, gil." },
    { speaker: "Punga", img: "/img/punga.png", text: "Hagamos así. Jugamos a esto, hay 3 vasos y una pelota. Si adivinás en qué vaso está la pelota, ganaste. Si no, te robo todo ameo." },
    { speaker: "Narrador", img: "/img/punga.png", text: "(El juego: Hay tres vasos y en uno hay una pelota dentro. El ladrón mueve de lugar los vasos y tenés que seleccionar el que tiene la pelota.)" },
    { speaker: "Narrador", img: "/img/punga.png", text: "(Si lo hacés, el ladrón te perdona y se va. Si no, te roba y se termina la sala.)" },
    // Aquí se debería mostrar el minijuego de los vasos
    { speaker: "Usuario", img: "/img/usuario.png", text: "¡Vamos por dios!" },
    { speaker: "Punga", img: "/img/punga.png", text: "Ahhh, que suerte que tene wachin." },
    { speaker: "Usuario", img: "/img/usuario.png", text: "Chau, nos re vimos papa." },
    { speaker: "Usuario", img: "/img/usuario.png", text: "No, porfavor, no me hagas nada." },
    { speaker: "Punga", img: "/img/punga.png", text: "Aceptaste el desafio, ahora tene que cumpli la consecuencia." },
    { speaker: "Usuario", img: "/img/usuario.png", text: "Noooo, porfavor." },
    { speaker: "Narrador", img: "/img/punga.png", text: "(El punga te roba todo lo que tenes y la ropa, lo que no te permite seguir jugando y tenes que reiniciar.)" },
    { speaker: "Punga", img: "/img/punga.png", text: "Otra vez vos... dale, jugá de nuevo si te animás." }
];

// Estados: 0 = diálogo, 1 = minijuego, 2 = resultado
let dialogueIndex = 0;
let minijuegoMostrado = false;

function renderDialogue() {
    const box = document.getElementById("dialogueBox");
    const btn = document.getElementById("nextBtn");

    // Mostrar el minijuego de vasos en el momento adecuado
    if (dialogueIndex === 12 && !minijuegoMostrado) {
        box.innerHTML = `<div style='width:100%;text-align:center;'>
            <h3>¡Minijuego de los vasos!</h3>
            <p>Elegí uno de los tres vasos para encontrar la pelota.</p>
            <div style='display:flex;justify-content:center;gap:40px;margin:32px 0;'>
                <img src='/img/vaso.png' onclick='resolverMinijuego(0)' style='width:80px;cursor:pointer;'>
                <img src='/img/vaso.png' onclick='resolverMinijuego(1)' style='width:80px;cursor:pointer;'>
                <img src='/img/vaso.png' onclick='resolverMinijuego(2)' style='width:80px;cursor:pointer;'>
            </div>
        </div>`;
        btn.style.display = "none";
        minijuegoMostrado = true;
        return;
    }

    // Mostrar resultado del minijuego
    if (dialogueIndex === 13 && minijuegoMostrado) {
        // Esperar a que el usuario resuelva el minijuego
        return;
    }

    // Mostrar diálogo normal
    const d = dialogue[dialogueIndex];
    if (!d) {
        box.innerHTML = `<div style='width:100%;text-align:center;'><h3>Fin del diálogo</h3></div>`;
        btn.style.display = "none";
        return;
    }
    let align = d.speaker === "Usuario" ? "row-reverse" : "row";
    let speakerName = d.speaker !== "Narrador" ? `<div class='rpg-dialogue-speaker'>${d.speaker}</div>` : "";
    let img = d.speaker === "Narrador" ? "" : `<img class='rpg-dialogue-img' src='${d.img}' alt='${d.speaker}'>`;
    box.innerHTML = `<div style='display:flex;flex-direction:${align};align-items:flex-end;width:100%;'>
        ${img}
        <div class='rpg-dialogue-text'>${speakerName}${d.text}</div>
    </div>`;
    btn.style.display = "block";
}

function nextDialogue() {
    // Saltar los diálogos de resultado según el minijuego
    if (dialogueIndex === 12 && minijuegoMostrado) return;
    dialogueIndex++;
    renderDialogue();
}

function resolverMinijuego(vasoElegido) {
    // Simular resultado aleatorio
    const vasoCorrecto = Math.floor(Math.random() * 3);
    const box = document.getElementById("dialogueBox");
    const btn = document.getElementById("nextBtn");
    if (vasoElegido === vasoCorrecto) {
        dialogueIndex = 13; // Diálogo de ganar
        box.innerHTML = `<div style='width:100%;text-align:center;'><h3>¡Ganaste!</h3><p>¡Encontraste la pelota!</p></div>`;
        setTimeout(() => { dialogueIndex = 14; renderDialogue(); }, 1200);
    } else {
        dialogueIndex = 16; // Diálogo de perder
        box.innerHTML = `<div style='width:100%;text-align:center;'><h3>Perdiste</h3><p>No encontraste la pelota...</p></div>`;
        setTimeout(() => { dialogueIndex = 17; renderDialogue(); }, 1200);
    }
    btn.style.display = "none";
}

window.onload = renderDialogue;
</script>
